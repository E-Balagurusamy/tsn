<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triotion Dstat</title>
    
    <meta property="description" content="Real-time Dstat visualization for Triotion with page view tracking">
    <meta property="title" content="Triotion | Dstat">
    
    <!-- View Count API Integration -->
    <script src="https://api.countapi.xyz/hit/triotion/dstat"></script>

    <link rel="icon" href="https://example.com/favicon.png" type="image/png" sizes="32x32">
    
    <style>
        body {
            background: radial-gradient(circle, rgba(63, 94, 251, 1) 0%, rgba(252, 70, 107, 1) 100%);
            font-family: Arial, sans-serif;
            color: white;
            text-align: center;
        }

        #chart {
            width: 80vw;
            height: 60vh;
            margin: 20vh auto;
        }

        #viewCount {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h1>Triotion Dstat</h1>
    <p>Real-time Request Monitoring</p>
    
    <!-- Chart for Dstat -->
    <div id="chart"></div>
    
    <!-- View Count Display -->
    <div id="viewCount">Loading views...</div>

    <script src="https://cdn.jsdelivr.net/npm/echarts@5"></script>
    
    <script>
        // ECharts initialization
        const chart = echarts.init(document.getElementById('chart'));
        
        const option = {
            title: {
                text: 'Requests per Second',
                textStyle: {
                    color: '#ffffff',
                },
            },
            legend: {
                data: ['Requests per Second'],
                textStyle: {
                    color: '#ffffff',
                },
            },
            xAxis: {
                type: 'category',
                data: [],
                axisLine: {
                    lineStyle: {
                        color: '#ffffff',
                    },
                },
                axisLabel: {
                    color: '#ffffff',
                },
            },
            yAxis: {
                type: 'value',
                axisLine: {
                    lineStyle: {
                        color: '#ffffff',
                    },
                },
                axisLabel: {
                    color: '#ffffff',
                },
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross',
                },
            },
            series: [{
                name: 'Requests per Second',
                type: 'line',
                smooth: true,
                data: [],
                maxDataPoints: 30,
                itemStyle: {
                    color: '#91cc75',
                },
            }],
        };

        chart.setOption(option);

        // Fetch Dstat data and update the chart every second
        setInterval(() => {
            fetch('/api/totalReqCount')
                .then(response => response.json())
                .then(data => {
                    const now = new Date();
                    const time = `${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

                    option.xAxis.data.push(time);
                    option.series[0].data.push(data.totalReqCount);

                    if (option.xAxis.data.length > option.series[0].maxDataPoints) {
                        option.xAxis.data.shift();
                        option.series[0].data.shift();
                    }

                    chart.setOption(option, true);
                })
                .catch(error => console.error('Error fetching data:', error));
        }, 1000);

        // Fetch and display the view count using CountAPI
        fetch('https://api.countapi.xyz/hit/triotion/dstat')
            .then(response => response.json())
            .then(data => {
                document.getElementById('viewCount').innerText = `Views: ${data.value}`;
            })
            .catch(error => console.error('Error fetching view count:', error));
    </script>
</body>

  </html>
      
