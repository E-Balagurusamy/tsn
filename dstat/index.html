<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triotion Dstat</title>

    <meta property="description" content="Real-time Dstat visualization for Triotion using CountAPI">
    <meta property="title" content="Triotion | Dstat">

    <!-- CountAPI script for hit tracking -->
    <script src="https://api.countapi.xyz/hit/triotion.xyz/dstat"></script>

    <style>
        body {
            background-color: black;
            font-family: 'Arial', sans-serif;
            color: white;
            text-align: center;
            margin: 0;
            padding: 0;
        }

        h1, p {
            margin-top: 20px;
        }

        #chart {
            width: 80vw;
            height: 60vh;
            margin: 20vh auto;
        }

        #viewCount {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #91cc75;
        }

        /* Scrollbar and theme custom color */
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #91cc75;
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <h1>Triotion Dstat</h1>
    <p>Real-time Request Tracking</p>

    <!-- Graph for Dstat -->
    <div id="chart"></div>

    <!-- View Count Display -->
    <div id="viewCount">Loading views...</div>

    <!-- Load ECharts library for charting -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5"></script>

    <script>
        // Initialize ECharts
        const chart = echarts.init(document.getElementById('chart'));

        const option = {
            title: {
                text: 'Requests per Second',
                textStyle: {
                    color: '#91cc75',
                },
            },
            xAxis: {
                type: 'category',
                data: [],
                axisLine: {
                    lineStyle: {
                        color: '#91cc75',
                    },
                },
                axisLabel: {
                    color: '#91cc75',
                },
            },
            yAxis: {
                type: 'value',
                axisLine: {
                    lineStyle: {
                        color: '#91cc75',
                    },
                },
                axisLabel: {
                    color: '#91cc75',
                },
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross',
                },
            },
            series: [{
                name: 'Requests per Second',
                type: 'line',
                smooth: true,
                data: [],
                maxDataPoints: 30,
                itemStyle: {
                    color: '#91cc75',
                },
            }],
        };

        chart.setOption(option);

        // Function to fetch data from CountAPI and update the graph
        function updateGraph() {
            fetch('https://nodec.mediathektv.com/nginx_status')
                .then(response => response.json())
                .then(data => {
                    const now = new Date();
                    const time = `${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

                    option.xAxis.data.push(time);
                    option.series[0].data.push(data.value);

                    if (option.xAxis.data.length > option.series[0].maxDataPoints) {
                        option.xAxis.data.shift();
                        option.series[0].data.shift();
                    }

                    chart.setOption(option, true);
                })
                .catch(error => console.error('Error fetching data from CountAPI:', error));
        }

        // Update the graph every second
        setInterval(updateGraph, 1000);

        // Fetch and display the total view count using CountAPI
        fetch('https://nodec.mediathektv.com/nginx_status')
            .then(response => response.json())
            .then(data => {
                document.getElementById('viewCount').innerText = `Views: ${data.value}`;
            })
            .catch(error => console.error('Error fetching view count:', error));
    </script>
</body>

</html>
